
<html lang="ka">
<head>
<meta charset="UTF-8">
<title>ექთნების მორიგეობის სისტემა</title>
<style>
body {
  font-family: sans-serif;
  padding: 20px;
}
table {
  border-collapse: collapse;
  margin-top: 15px;
}
th, td {
  border: 1px solid #aaa;
  padding: 4px;
  text-align: center;
}
select {
  width: 60px;
}
input, button {
  margin: 5px;
}
.total {
  font-weight: bold;
  background: #f0f0f0;
}
</style>
</head>

<body>

<h2>ექთნების მორიგეობის ცხრილი</h2>

<input id="nurseName" placeholder="სახელი და გვარი">
<button onclick="addNurse()">➕ დამატება</button>

<br>

<input id="searchName" placeholder="ძებნა სახელით" oninput="searchByName()">
<input id="searchDay" type="number" min="1" max="31" placeholder="რიცხვი" oninput="searchByDay()">

<br>
<button onclick="autoGenerate()">⚙️ ყოველ მე-4 დღეზე დაგენერირება</button>

<div id="tableContainer"></div>

<script>
const DAYS = 31;
const shiftOptions = ["", 8, 16, 24];

let nurses = [];
let schedule = {};

function addNurse() {
  const name = document.getElementById("nurseName").value.trim();
  if (!name) return;
  const id = Date.now();
  nurses.push({ id, name });
  schedule[id] = {};
  document.getElementById("nurseName").value = "";
  render();
}

function removeNurse(id) {
  nurses = nurses.filter(n => n.id !== id);
  delete schedule[id];
  render();
}

function updateShift(id, day, value) {
  schedule[id][day] = Number(value);
  render();
}

function totalHours(id) {
  return Object.values(schedule[id] || {}).reduce((a,b)=>a+(b||0),0);
}

function autoGenerate() {
  nurses.forEach(n => {
    for (let d = 1; d <= DAYS; d += 4) {
      if (!schedule[n.id][d]) {
        schedule[n.id][d] = 24;
      }
    }
  });
  render();
}

function searchByName() {
  const q = document.getElementById("searchName").value.toLowerCase();
  document.querySelectorAll("tbody tr").forEach(tr => {
    tr.style.display = tr.dataset.name.includes(q) ? "" : "none";
  });
}

function searchByDay() {
  const day = document.getElementById("searchDay").value;
  document.querySelectorAll("tbody tr").forEach(tr => {
    if (!day) {
      tr.style.display = "";
      return;
    }
    const cell = tr.querySelector(`[data-day="${day}"]`);
    tr.style.display = cell && cell.value ? "" : "none";
  });
}

function render() {
  let html = "<table><thead><tr><th>ექთანი</th>";
  for (let d=1; d<=DAYS; d++) html += `<th>${d}</th>`;
  html += "<th>ჯამი</th><th></th></tr></thead><tbody>";

  nurses.forEach(n => {
    html += `<tr data-name="${n.name.toLowerCase()}"><td>${n.name}</td>`;
    for (let d=1; d<=DAYS; d++) {
      html += `<td>
        <select data-day="${d}" onchange="updateShift(${n.id},${d},this.value)">
          ${shiftOptions.map(o=>`
            <option value="${o}" ${schedule[n.id][d]==o?"selected":""}>${o}</option>
          `).join("")}
        </select>
      </td>`;
    }
    html += `<td class="total">${totalHours(n.id)}</td>
             <td><button onclick="removeNurse(${n.id})">❌</button></td></tr>`;
  });

  html += "</tbody></table>";
  document.getElementById("tableContainer").innerHTML = html;
}

render();
</script>

</body>
</html>
